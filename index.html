<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
    <title>Khaled's portfolio</title>
    <meta name="description" content="Khaled's portfolio showcasing projects and skills" />
    <meta name="author" content="Khaled" />

    <meta property="og:title" content="Khaled's portfolio" />
    <meta property="og:description" content="Welcome to Khaled's portfolio, showcasing my projects and skills as a Full Stack Developer." />
    <meta property="og:type" content="website" />

    <!-- Additional mobile optimizations -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <style>
      /* Initialize the app height variable */
      :root {
        --app-height: 100vh;
      }
      
      /* Prevent zoom on input focus for iOS */
      input[type="text"],
      input[type="email"],
      input[type="password"],
      textarea,
      select {
        font-size: 16px !important;
      }
      
      /* Prevent elastic scrolling on iOS */
      html, body {
        overscroll-behavior: none;
        overscroll-behavior-y: none;
      }
    </style>
  </head>

  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
    <script>
      // Mobile Keyboard Fix Script
      (function() {
        'use strict';
        
        // Check if we're on a mobile device
        const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        
        if (!isMobile) return;
        
        let initialViewportHeight = window.innerHeight;
        let isKeyboardOpen = false;
        let resizeTimeout;
        
        // Store original scroll position
        let originalScrollY = 0;
        
        // Function to set app height
        function setAppHeight() {
          const vh = window.innerHeight * 0.01;
          document.documentElement.style.setProperty('--app-height', `${window.innerHeight}px`);
        }
        
        // Function to handle viewport changes
        function handleViewportChange() {
          const currentHeight = window.innerHeight;
          const heightDifference = initialViewportHeight - currentHeight;
          
          // Keyboard is likely open if height decreased significantly
          const keyboardThreshold = 150; // Adjust this value as needed
          
          if (heightDifference > keyboardThreshold && !isKeyboardOpen) {
            // Keyboard opened
            isKeyboardOpen = true;
            document.body.classList.add('keyboard-active');
            document.body.classList.remove('keyboard-dismissed');
            
            // Store current scroll position
            originalScrollY = window.scrollY;
            
            // Add viewport reset class to main container
            const mainContainer = document.querySelector('main, .app-container, #root');
            if (mainContainer) {
              mainContainer.classList.add('viewport-reset');
            }
            
          } else if (heightDifference <= keyboardThreshold && isKeyboardOpen) {
            // Keyboard closed
            isKeyboardOpen = false;
            document.body.classList.remove('keyboard-active');
            document.body.classList.add('keyboard-dismissed');
            
            // Force scroll to prevent white space
            setTimeout(() => {
              window.scrollTo(0, Math.max(0, originalScrollY));
              
              // Remove viewport reset class
              const mainContainer = document.querySelector('main, .app-container, #root');
              if (mainContainer) {
                mainContainer.classList.remove('viewport-reset');
              }
              
              // Force layout recalculation
              setAppHeight();
              document.body.style.minHeight = '100vh';
              document.body.style.minHeight = '100dvh';
              document.body.style.minHeight = 'var(--app-height)';
              
              // Remove keyboard-dismissed class after transition
              setTimeout(() => {
                document.body.classList.remove('keyboard-dismissed');
              }, 300);
            }, 100);
          }
        }
        
        // Debounced resize handler
        function onResize() {
          clearTimeout(resizeTimeout);
          resizeTimeout = setTimeout(() => {
            setAppHeight();
            handleViewportChange();
          }, 100);
        }
        
        // Input focus handlers
        function onInputFocus(e) {
          // Scroll input into view smoothly
          setTimeout(() => {
            e.target.scrollIntoView({
              behavior: 'smooth',
              block: 'center',
              inline: 'nearest'
            });
          }, 300);
        }
        
        function onInputBlur(e) {
          // Force viewport reset on blur
          setTimeout(() => {
            if (!isKeyboardOpen) {
              window.scrollTo(0, 0);
              setAppHeight();
              document.body.style.minHeight = '100vh';
              document.body.style.minHeight = '100dvh';
              document.body.style.minHeight = 'var(--app-height)';
            }
          }, 100);
        }
        
        // Initialize event listeners
        function init() {
          // Set initial viewport height
          initialViewportHeight = window.innerHeight;
          setAppHeight();
          
          // Listen for resize events
          window.addEventListener('resize', onResize);
          
          // Listen for orientation change
          window.addEventListener('orientationchange', () => {
            setTimeout(() => {
              initialViewportHeight = window.innerHeight;
              setAppHeight();
              handleViewportChange();
            }, 500);
          });
          
          // Add input event listeners
          document.addEventListener('focusin', (e) => {
            if (e.target.matches('input, textarea, select')) {
              onInputFocus(e);
            }
          });
          
          document.addEventListener('focusout', (e) => {
            if (e.target.matches('input, textarea, select')) {
              onInputBlur(e);
            }
          });
          
          // Prevent default touch behavior that might cause scrolling issues
          document.addEventListener('touchmove', (e) => {
            if (isKeyboardOpen && e.target.tagName !== 'INPUT' && e.target.tagName !== 'TEXTAREA') {
              e.preventDefault();
            }
          }, { passive: false });
          
          // Handle scroll events to prevent white space
          window.addEventListener('scroll', () => {
            if (window.scrollY < 0) {
              window.scrollTo(0, 0);
            }
          });
          
          // Visual viewport API support (modern browsers)
          if (window.visualViewport) {
            window.visualViewport.addEventListener('resize', () => {
              setAppHeight();
              handleViewportChange();
            });
          }
        }
        
        // Initialize when DOM is ready
        if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', init);
        } else {
          init();
        }
        
        // Expose utility functions for manual fixes
        window.fixMobileViewport = function() {
          isKeyboardOpen = false;
          document.body.classList.remove('keyboard-active');
          document.body.classList.add('keyboard-dismissed');
          
          setTimeout(() => {
            window.scrollTo(0, 0);
            setAppHeight();
            document.body.style.minHeight = '100vh';
            document.body.style.minHeight = '100dvh';
            document.body.style.minHeight = 'var(--app-height)';
            document.body.classList.remove('keyboard-dismissed');
          }, 100);
        };
        
      })();
    </script>
  </body>
</html>
